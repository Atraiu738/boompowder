<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Lucky Spin</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{
  font-family:'Poppins',sans-serif;
  background:#f4f6fa;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  height:100vh;
  color:#222;
}
.card{
  background:#ffffff;
  padding:20px 30px;
  border-radius:12px;
  border:1px solid #ddd;
  text-align:center;
  box-shadow:0 2px 6px rgba(0,0,0,0.05);
}
input,button{
  padding:10px 14px;
  border-radius:6px;
  border:1px solid #ccc;
  font-size:15px;
  margin-top:10px;
}
button{
  background:#007aff;
  color:white;
  border:none;
}
button:hover{background:#005fcc}
#wheelWrap{
  display:none;
  margin-top:40px;
  position:relative;
}
#eventBanner{
  display:none;
  background:#ffd94a;
  color:#222;
  font-weight:bold;
  padding:8px 18px;
  border-radius:8px;
  margin-bottom:10px;
  box-shadow:0 2px 6px rgba(0,0,0,0.2);
}
#pointer{
  width:0;height:0;
  border-left:18px solid transparent;
  border-right:18px solid transparent;
  border-bottom:30px solid #ff5252;
  position:absolute;
  top:-12px;
  left:calc(50% - 18px);
}
#wheel{
  width:350px;height:350px;
  border-radius:50%;
  border:6px solid #333;
  overflow:hidden;
  position:relative;
  transition:transform 6s ease-out;
}
.slice{
  position:absolute;
  width:50%;
  height:50%;
  top:50%;
  left:50%;
  transform-origin:0 0;
  display:flex;
  align-items:flex-end;
  justify-content:center;
  padding:6px;
  font-size:14px;
  font-weight:600;
  color:white;
  text-align:center;
}
#resultBox{
  margin-top:25px;
  font-size:22px;
  font-weight:bold;
  padding:10px 20px;
  border-radius:8px;
  background:#fff;
  border:2px solid #007aff;
  display:none;
  color:#007aff;
}
</style>
</head>
<body>

<div class="card">
  <h2>Enter Spin Code</h2>
  <input id="codeInput" placeholder="Code">
  <button onclick="unlock()">Submit</button>
  <p id="msg"></p>
</div>

<div id="eventBanner">âœ¨ EVENT ACTIVE â€” Better Rewards!</div>

<div id="wheelWrap">
  <div id="pointer"></div>
  <div id="wheel"></div>
  <button onclick="spin()">SPIN</button>
  <div id="resultBox"></div>
</div>

<script>
// EVENT STATE read from admin panel
const eventActive = localStorage.getItem("eventActive") === "true";

// Normal rarity values
const normalWeights = {
  "Try Again": 35,
  "50 Tokens": 10,
  "Small Prize": 14,
  "Big Prize": 14,
  "Paper Planes": 14,
  "Squishys": 7,
  "1 Week Free VIP": 6
};

// Event boosted rarity values
const eventWeights = {
  "Try Again": 20,
  "50 Tokens": 10,
  "Small Prize": 14,
  "Big Prize": 25,
  "Paper Planes": 14,
  "Squishys": 9,
  "1 Week Free VIP": 8
};

// Get correct weight for prize
function getWeight(name){
  return eventActive ? eventWeights[name] : normalWeights[name];
}

// Make prize list for wheel
const prizes = [
  { name:"Try Again", weight:getWeight("Try Again") },
  { name:"50 Tokens", weight:getWeight("50 Tokens") },
  { name:"Small Prize", weight:getWeight("Small Prize") },
  { name:"Big Prize", weight:getWeight("Big Prize") },
  { name:"Paper Planes", weight:getWeight("Paper Planes") },
  { name:"Squishys", weight:getWeight("Squishys") },
  { name:"1 Week Free VIP", weight:getWeight("1 Week Free VIP") }
];

// Show event banner if ON
if(eventActive){
  document.getElementById("eventBanner").style.display="block";
}

let wheelUnlocked=false;

// Unlock spin with 1-time code
function unlock(){
  let code=document.getElementById("codeInput").value;
  let codes=JSON.parse(localStorage.getItem("validCodes")||"[]");

  if(codes.includes(code)){
    wheelUnlocked=true;
    document.getElementById("wheelWrap").style.display="block";
    document.getElementById("msg").innerHTML="âœ” Code accepted â€” spin now!";

    // remove from valid
    let updated=codes.filter(c=>c!==code);
    localStorage.setItem("validCodes",JSON.stringify(updated));

    // add to used
    let used=JSON.parse(localStorage.getItem("usedCodes")||"[]");
    used.push(code);
    localStorage.setItem("usedCodes",JSON.stringify(used));

  }else{
    document.getElementById("msg").innerHTML="âŒ Invalid or already used";
  }
}

// Build wheel graphics
let wheel=document.getElementById("wheel");
let sliceAngle=360/prizes.length;
let colors=["#ff6961","#fcd56d","#77dd77","#6aa9ff","#b39ddb","#ff9ec4","#ffb482"];

prizes.forEach((p,i)=>{
  let slice=document.createElement("div");
  slice.className="slice";
  slice.style.background=colors[i];
  slice.style.transform=`rotate(${sliceAngle*i}deg) skewY(${90 - sliceAngle}deg)`;
  slice.innerHTML=p.name;
  wheel.appendChild(slice);
});

let rotation=0;

// Weighted rarity picker
function pickPrize(){
  let total=prizes.reduce((sum,p)=>sum+p.weight,0);
  let r=Math.random()*total;
  for(let p of prizes){
    if(r<p.weight) return p.name;
    r-=p.weight;
  }
}

function spin(){
  if(!wheelUnlocked){
    document.getElementById("msg").innerHTML="ðŸ”’ Enter new code to spin again";
    return;
  }

  document.getElementById("resultBox").style.display="none";

  rotation+=720+(Math.random()*360);
  wheel.style.transform=`rotate(${rotation}deg)`;

  setTimeout(()=>{
    let result=pickPrize();
    let box=document.getElementById("resultBox");
    box.innerHTML="ðŸŽ‰ You won: <b>"+result+"</b>";
    box.style.display="block";

    wheelUnlocked=false;
    document.getElementById("msg").innerHTML="ðŸ”’ Enter new code to spin again";
  },6000);
}
</script>

</body>
</html>
